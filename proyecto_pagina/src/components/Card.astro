---
import "@/styles/global.css"
import type { ImageMetadata } from "astro"
import { Image } from "astro:assets"

const {title, imagePath, altText, date, description, folderPath} = Astro.props

// Función para obtener imágenes basada en folderPath
function getImagesFromFolder(folder: string) {
  const imageCollections: Record<string, any> = {
    'projects_images': import.meta.glob<{ default: ImageMetadata }>(
      `/src/assets/projects_images/*.{jpeg,jpg,png,gif}`,
    ),
    'news_images': import.meta.glob<{ default: ImageMetadata }>(
      `/src/assets/news_images/*.{jpeg,jpg,png,gif}`,
    ),
    'portfolio_images': import.meta.glob<{ default: ImageMetadata }>(
      `/src/assets/portfolio_images/*.{jpeg,jpg,png,gif}`,
    ),
  }
  
  return imageCollections[folder] || imageCollections['projects_images'];
}

const images = getImagesFromFolder(folderPath || 'projects_images');

if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "src/assets/${folderPath || 'projects_images'}/*.{jpeg,jpg,png,gif}"`,
  );

console.log(title)

const createSlug = (title: string) => {
  return (
    title
      // remove leading & trailing whitespace
      .trim()
      // remove special characters
      .replace(/[^A-Za-z0-9 ]/g, "")
      // replace spaces
      .replace(/\s+/g, "-")
      // remove leading & trailing separtors
      .replace(/^-+|-+$/g, "")
      // output lowercase
      .toLowerCase()
  );
};
---

<article class="shadow-md hover:shadow-[0_4px_15px_rgba(17,24,39,0.7)] blog">
  <div class="p-5">
    <a href={`/projects/${createSlug(title)}`}>
      <Image class="rounded-2xl" src={images[imagePath]()} alt={altText} transition:name={`img-${createSlug(title)}`}/>
    </a>
  </div>
  <div class="p-5 flex flex-col">
    <span class="text-center text-base text-gray-400">{title}</span>
    <h1 class="text-center text-xl font-bold mb-2">
        Publicado el {date.getFullYear()}/{date.getMonth() + 1}/{date.getDate()}
    </h1>
    <p class="text-base text-center">{description}</p>
    <div class="flex justify-center mt-3">
      <a href={`/projects/${createSlug(title)}`} class="btn-primary font-bold"
        >Leer más...</a
      >
    </div>
  </div>
</article>

<style>
  @layer utilities {
    .blog {
      animation: reveal linear both;
      animation-timeline: view();
      animation-range: entry 20% cover 30%;
    }
  }

  @keyframes reveal {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>